/*
  Fondo plano + mejoras mobile (PiP, topbar, safe-areas, auto-hide)
  + Landscape móvil: cubrir viewport, ocultar header global y sin scroll.
  + Overlay para pedir horizontal en móviles (sin botón).
  Fecha: 21-ago-2025
*/

/* ===== Base / tema ===== */
.abog-no-scroll { overflow: hidden !important; height: 100vh !important; }

:root { --abog-bg: #0b1220; }

.abog-video-dark,
.abog-video-page,
.str-video,
.str-video__theme { background: var(--abog-bg) !important; }

.abog-video-page { position: relative; min-height: 100vh; isolation: isolate; }
.abog-video-page::before { content: none !important; display: none !important; }

/* Tema Stream */
.str-video__theme, .str-video, .abog-theme{
  --str-video__primary-color: #E85D99;
  --str-video__accent-color:  #E85D99;
  --str-video__on-primary-color: #ffffff;
  --str-video__on-surface-color: #ffffff;
  --str-video__primary-surface-color: var(--abog-bg);
  --str-video__secondary-surface-color: var(--abog-bg);
  --str-video__border-color: rgba(232, 93, 153, 0.35);
  --str-video__control-bar-bg: rgba(16, 22, 36, 0.68);
}

/* ===== Stage ===== */
.abog-stage{
  position: relative;
  width: min(1200px, 96vw);
  height: min(84dvh, calc(100dvh - 120px));
  margin: 6px auto 0;
  border-radius: 16px;
  overflow: visible;
  padding-bottom: 108px; /* espacio para dock */
  box-sizing: border-box;
  box-shadow: none !important;
  background: transparent !important;
  cursor: default;
}
@supports not (height: 100dvh) {
  .abog-stage{ height: min(84vh, calc(100vh - 120px)); }
}
.abog-stage .str-video__call,
.abog-stage .str-video__layout,
.abog-stage .str-video__speaker-layout{
  height: 100% !important;
  background: transparent !important;
}
.abog-stage video{
  object-fit: cover !important;
  background: var(--abog-bg);
  border-radius: 16px;
}

/* ===== HERO + PiP (mobile) ===== */
@media (max-width: 768px){
  .abog-stage .str-video__speaker-layout{
    position: relative !important;
    display: block !important;
    padding: 0 !important;
  }
  .abog-stage .str-video__speaker-layout > [class*="participant-tile"]:first-child{
    position: absolute !important;
    inset: 0 !important;
    width: 100% !important;
    height: 100% !important;
    border-radius: 16px !important;
  }
  .abog-stage .str-video__speaker-layout > [class*="participant-tile"]:not(:first-child){
    position: absolute !important;
    top: calc(env(safe-area-inset-top, 0px) + 56px) !important;
    right: 12px !important;
    left: auto !important;
    bottom: auto !important;
    width: clamp(140px, 38vw, 240px) !important;
    height: auto !important;
    aspect-ratio: 16/10 !important;
    border-radius: 12px !important;
    box-shadow: 0 10px 26px rgba(0,0,0,.45) !important;
    z-index: 8 !important;
    background: #0f172a !important;
  }
  .abog-stage .str-video__menu-button{ display:none !important; }
}

/* ===== PiP clases internas ===== */
.abog-stage :is(
  .str-video__participant-tile--pip,
  .str-video__participant-tile--floating,
  .str-video__pip
){
  position: absolute !important;
  top: 14px !important; right: 14px !important;
  left: auto !important; bottom: auto !important;
  width: clamp(180px, 28%, 320px) !important; max-width: 320px !important;
  transform: none !important; z-index: 10; border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
}
.abog-stage :is(
  .str-video__participant-tile--pip,
  .str-video__participant-tile--floating,
  .str-video__pip
) video{ object-fit: cover !important; border-radius: 12px !important; }

/* ===== Dock de controles ===== */
.abog-controls-dock{
  position: fixed; left: 50%; transform: translateX(-50%);
  bottom: calc(14px + env(safe-area-inset-bottom, 0px));
  z-index: 1000; pointer-events: auto;
  transition: opacity .18s ease, transform .18s ease;
}
.abog-controls-dock .str-video__call-controls{
  background: var(--str-video__control-bar-bg);
  backdrop-filter: saturate(120%) blur(10px);
  border: 1px solid rgba(232, 93, 153, 0.25);
  box-shadow: 0 20px 50px rgba(0,0,0,.45);
  border-radius: 999px; padding: 10px; gap: 4px;
}
.abog-controls-dock .str-video__button{
  background: rgba(255,255,255,.06) !important;
  border: 1px solid rgba(255,255,255,.10) !important;
  color: #fff !important; transition: transform .15s, box-shadow .15s, filter .15s;
}
.abog-controls-dock .str-video__button:hover{ transform: translateY(-2px); box-shadow: 0 8px 22px rgba(0,0,0,.35); filter: brightness(1.06); }
.abog-controls-dock .str-video__button:focus-visible{ outline: 2px solid #E85D99 !important; outline-offset: 2px; }
.str-video__button[aria-pressed="true"], .str-video__toggle-button--on, .str-video__button--primary{ background: #E85D99 !important; border-color: #E85D99 !important; color: #fff !important; }
.abog-controls-dock :is(
  button[aria-label*="Leave" i], button[aria-label*="End" i],
  button[title*="Leave" i], button[title*="End" i],
  button[data-testid*="leave" i]
){ background: #ff4d4f !important; border-color: #ff4d4f !important; }
.str-video__icon, .str-video__button--primary .str-video__icon{ color:#fff !important; }

/* ===== Nameplates ===== */
.abog-stage :is(
  .str-video__participant-nameplate,
  .str-video__participant-tile__footer,
  .str-video__participant-label,
  [class*="participant"][class*="name"],
  [class*="nameplate"],
  [data-testid*="participant-name"],
  .str-video__caption
){
  color:#fff !important;
  background: linear-gradient(135deg, rgba(9,13,22,.92), rgba(9,13,22,.78)) !important;
  border:1px solid rgba(232,93,153,.55) !important;
  border-radius:10px !important; padding:6px 10px !important;
  text-shadow:0 1px 2px rgba(0,0,0,.85) !important;
  backdrop-filter: saturate(120%) blur(6px);
  max-width: 68vw; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.abog-stage :is(
  .str-video__participant-nameplate .str-video__icon,
  .str-video__participant-tile__footer .str-video__icon,
  .str-video__participant-label .str-video__icon
){ color:#fff !important; opacity:.95 !important; }

/* ===== Menús / popovers ===== */
.str-video__menu,
.str-video__popover,
.str-video__context-menu,
[role="menu"].str-video__menu{
  --str-video__on-surface-color:#fff !important;
  --str-video__text-color:#fff !important;
  --sds-text-color:#fff !important;
  color:#fff !important;
  background:#111827 !important;
  border:1px solid rgba(232,93,153,.35) !important;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
}
.str-video__menu :is(*),
.str-video__context-menu :is(*),
[role="menu"].str-video__menu :is(li,button,span,div,p){ color:#fff !important; }
.str-video__menu svg, .str-video__context-menu svg{ color:#fff !important; fill:#fff !important; }

/* ===== Toasters ===== */
.abog-stage :is(
  .str-video__notification,
  .str-video__notification-toast,
  .str-video__snackbar,
  [role="status"],
  [role="alert"]
){
  position: static !important;
  background: initial !important;
  border: none !important;
  box-shadow: none !important;
  transform: none !important;
}

/* ===== Overlay de conexión / review modal ===== */
.abog-connecting{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.45); z-index:2000; text-align:center; color:#fff; }
.abog-connecting-spinner{ width:54px; height:54px; border-radius:50%; border:4px solid rgba(255,255,255,.25); border-top-color:#fff; animation:abog-spin 1s linear infinite; margin:0 auto 12px; }
@keyframes abog-spin{ to{ transform:rotate(360deg); } }

.abog-rate-backdrop{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:3000; }
.abog-rate-card{ background:#111; color:#fff; border-radius:12px; padding:24px; width:min(520px,92vw); border:1px solid rgba(232,93,153,.25); box-shadow:0 10px 30px rgba(0,0,0,.5); }
.abog-stars{ display:flex; gap:8px; font-size:28px; margin-bottom:12px; }
.abog-star-btn{ background:transparent; border:none; cursor:pointer; padding:0; line-height:1; }
.abog-rate-textarea{ width:100%; border-radius:8px; border:1px solid #333; padding:12px; background:#0b0b0b; color:#fff; }
.abog-rate-actions{ display:flex; gap:12px; margin-top:16px; justify-content:flex-end; }

/* ===== Topbar móvil ===== */
.abog-mobile-topbar{
  position: fixed;
  top: env(safe-area-inset-top, 0px);
  left: 0; right: 0;
  display: none;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  background: linear-gradient(180deg, rgba(33,16,37,.9), rgba(16,22,36,.72));
  backdrop-filter: saturate(120%) blur(12px);
  border-bottom: 1px solid rgba(232,93,153,.25);
  z-index: 1100;
  color: #fff;
  transition: opacity .18s ease, transform .18s ease;
}
.abog-topbar-leave{
  width: 40px; height: 40px; border-radius: 10px;
  border: 1px solid rgba(255,255,255,.12);
  background: #ff4d4f; color: #fff; display: grid; place-items: center;
}
.abog-topbar-title{ font-weight: 700; letter-spacing: .02em; }
.abog-topbar-spacer{ margin-left: auto; }

/* ===== Auto-hide del chrome en móvil ===== */
.abog-chrome-hidden .abog-controls-dock{ opacity: 0; transform: translate(-50%, 12px); pointer-events: none; }
.abog-chrome-hidden .abog-mobile-topbar{ opacity: 0; transform: translateY(-10px); pointer-events: none; }

/* ===== MOBILE LANDSCAPE: cubrir viewport, ocultar header global y sin scroll ===== */
@media (max-width: 900px) and (orientation: landscape){
  body.abog-video-dark header,
  body.abog-video-dark [role="banner"],
  body.abog-video-dark .app-header,
  body.abog-video-dark .navbar,
  body.abog-video-dark .site-header{
    display: none !important;
  }
  .abog-video-page{
    position: fixed !important;
    inset: 0 !important;
    width: 100vw !important;
    height: 100dvh !important;
    overflow: hidden !important;
    z-index: 9999 !important;
    overscroll-behavior: contain;
    touch-action: manipulation;
  }
  .abog-mobile-topbar{ display: none !important; }
  .abog-stage{
    width: 100vw !important;
    height: calc(100dvh - 120px) !important;
    margin: 0 !important;
    border-radius: 0 !important;
    padding-bottom: 108px !important;
  }
  @supports not (height: 100dvh){
    .abog-video-page{ height: 100vh !important; }
    .abog-stage{ height: calc(100vh - 120px) !important; }
  }
}

/* ===== Responsive extras ===== */
@media (max-width: 900px){
  .abog-stage{ height:min(78dvh, calc(100dvh - 170px)); }
  @supports not (height: 100dvh) { .abog-stage{ height:min(78vh, calc(100vh - 170px)); } }
}
@media (max-width: 768px){
  .abog-mobile-topbar{ display: flex; }
  .abog-controls-dock .str-video__button{ transform: none; }
}
@media (max-width: 600px){
  .abog-stage{ height:min(74dvh, calc(100dvh - 196px)); }
  @supports not (height: 100dvh) { .abog-stage{ height:min(74vh, calc(100vh - 196px)); } }
}

/* ===== Overlay para pedir horizontal ===== */
.abog-orientation-overlay{
  position: fixed;
  inset: 0;
  z-index: 1200;
  background: #0b1220;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 24px;
}
.abog-orientation-card{
  max-width: 460px;
  width: 92vw;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(232,93,153,.25);
  border-radius: 16px;
  padding: 20px 18px;
  box-shadow: 0 10px 30px rgba(0,0,0,.5);
}
.abog-orientation-icon{ opacity:.9; margin: 2px auto 8px; }
.abog-orientation-card h4{ margin: 6px 0 6px; font-size: 1.2rem; }
.abog-orientation-card p{ margin: 0; color: #d1cbd6; }

/* Botones utilitarios del modal de reseña */
.btn-primary,.btn-secondary{ padding:10px 16px; border-radius:8px; border:none; cursor:pointer; font-weight:600; }
.btn-primary{ background:#E85D99; color:#fff; }
.btn-primary:hover{ filter:brightness(1.06); }
.btn-secondary{ background:transparent; color:#fff; border:1px solid rgba(255,255,255,.25); }
.btn-secondary:hover{ background:rgba(255,255,255,.08); }